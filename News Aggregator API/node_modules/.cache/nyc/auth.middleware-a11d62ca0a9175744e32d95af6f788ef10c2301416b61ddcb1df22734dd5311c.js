function cov_w34sgt26o(){var path="E:\\airtribe\\Projects\\Backend-projects\\News Aggregator API\\middlewares\\auth.middleware.js";var hash="3fc3567559ad3adaf97af3acaf71ec29f579beed";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"E:\\airtribe\\Projects\\Backend-projects\\News Aggregator API\\middlewares\\auth.middleware.js",statementMap:{"0":{start:{line:1,column:12},end:{line:1,column:35}},"1":{start:{line:2,column:15},end:{line:2,column:42}},"2":{start:{line:3,column:17},end:{line:3,column:37}},"3":{start:{line:7,column:20},end:{line:43,column:1}},"4":{start:{line:8,column:2},end:{line:42,column:3}},"5":{start:{line:13,column:4},end:{line:37,column:6}},"6":{start:{line:17,column:8},end:{line:21,column:9}},"7":{start:{line:18,column:10},end:{line:18,column:26}},"8":{start:{line:19,column:10},end:{line:19,column:52}},"9":{start:{line:20,column:10},end:{line:20,column:17}},"10":{start:{line:23,column:8},end:{line:35,column:13}},"11":{start:{line:27,column:12},end:{line:27,column:28}},"12":{start:{line:28,column:12},end:{line:28,column:43}},"13":{start:{line:29,column:12},end:{line:29,column:19}},"14":{start:{line:32,column:12},end:{line:32,column:28}},"15":{start:{line:33,column:12},end:{line:33,column:43}},"16":{start:{line:34,column:12},end:{line:34,column:19}},"17":{start:{line:39,column:4},end:{line:39,column:20}},"18":{start:{line:40,column:4},end:{line:40,column:51}},"19":{start:{line:41,column:4},end:{line:41,column:11}},"20":{start:{line:45,column:0},end:{line:47,column:2}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:7,column:20},end:{line:7,column:21}},loc:{start:{line:7,column:40},end:{line:43,column:1}},line:7},"1":{name:"(anonymous_1)",decl:{start:{line:16,column:6},end:{line:16,column:7}},loc:{start:{line:16,column:29},end:{line:36,column:7}},line:16},"2":{name:"(anonymous_2)",decl:{start:{line:26,column:16},end:{line:26,column:17}},loc:{start:{line:26,column:26},end:{line:30,column:11}},line:26},"3":{name:"(anonymous_3)",decl:{start:{line:31,column:17},end:{line:31,column:18}},loc:{start:{line:31,column:26},end:{line:35,column:11}},line:31}},branchMap:{"0":{loc:{start:{line:8,column:2},end:{line:42,column:3}},type:"if",locations:[{start:{line:8,column:2},end:{line:42,column:3}},{start:{line:8,column:2},end:{line:42,column:3}}],line:8},"1":{loc:{start:{line:9,column:4},end:{line:11,column:53}},type:"binary-expr",locations:[{start:{line:9,column:4},end:{line:9,column:15}},{start:{line:10,column:4},end:{line:10,column:29}},{start:{line:11,column:4},end:{line:11,column:53}}],line:9},"2":{loc:{start:{line:17,column:8},end:{line:21,column:9}},type:"if",locations:[{start:{line:17,column:8},end:{line:21,column:9}},{start:{line:17,column:8},end:{line:21,column:9}}],line:17}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0},f:{"0":0,"1":0,"2":0,"3":0},b:{"0":[0,0],"1":[0,0,0],"2":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"3fc3567559ad3adaf97af3acaf71ec29f579beed"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_w34sgt26o=function(){return actualCoverage;};}return actualCoverage;}cov_w34sgt26o();const jwt=(cov_w34sgt26o().s[0]++,require("jsonwebtoken"));const config=(cov_w34sgt26o().s[1]++,require("../config/config"));const{User}=(cov_w34sgt26o().s[2]++,require("../models"));// const userService = require("../services/user.service");
// token is retrieved from authorization header and check if its valid
cov_w34sgt26o().s[3]++;const verifyToken=(req,res,next)=>{cov_w34sgt26o().f[0]++;cov_w34sgt26o().s[4]++;if((cov_w34sgt26o().b[1][0]++,req.headers)&&(cov_w34sgt26o().b[1][1]++,req.headers.authorization)&&(cov_w34sgt26o().b[1][2]++,req.headers.authorization.split(" ")[0]==="JWT")){cov_w34sgt26o().b[0][0]++;cov_w34sgt26o().s[5]++;jwt.verify(req.headers.authorization.split(" ")[1],config.jwt.secret,function(err,decode){cov_w34sgt26o().f[1]++;cov_w34sgt26o().s[6]++;if(err){cov_w34sgt26o().b[2][0]++;cov_w34sgt26o().s[7]++;req.user=null;cov_w34sgt26o().s[8]++;req.message="Invalid JWT token: "+err;cov_w34sgt26o().s[9]++;next();}else{cov_w34sgt26o().b[2][1]++;}cov_w34sgt26o().s[10]++;User.findOne({_id:decode.sub}).then(user=>{cov_w34sgt26o().f[2]++;cov_w34sgt26o().s[11]++;req.user=user;cov_w34sgt26o().s[12]++;req.message="User validated";cov_w34sgt26o().s[13]++;next();}).catch(err=>{cov_w34sgt26o().f[3]++;cov_w34sgt26o().s[14]++;req.user=null;cov_w34sgt26o().s[15]++;req.message="User not found";cov_w34sgt26o().s[16]++;next();});});}else{cov_w34sgt26o().b[0][1]++;cov_w34sgt26o().s[17]++;req.user=null;cov_w34sgt26o().s[18]++;req.message="Authorization Header not found";cov_w34sgt26o().s[19]++;next();}};cov_w34sgt26o().s[20]++;module.exports={verifyToken};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb3ZfdzM0c2d0MjZvIiwiYWN0dWFsQ292ZXJhZ2UiLCJqd3QiLCJzIiwicmVxdWlyZSIsImNvbmZpZyIsIlVzZXIiLCJ2ZXJpZnlUb2tlbiIsInJlcSIsInJlcyIsIm5leHQiLCJmIiwiYiIsImhlYWRlcnMiLCJhdXRob3JpemF0aW9uIiwic3BsaXQiLCJ2ZXJpZnkiLCJzZWNyZXQiLCJlcnIiLCJkZWNvZGUiLCJ1c2VyIiwibWVzc2FnZSIsImZpbmRPbmUiLCJfaWQiLCJzdWIiLCJ0aGVuIiwiY2F0Y2giLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsiYXV0aC5taWRkbGV3YXJlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGp3dCA9IHJlcXVpcmUoXCJqc29ud2VidG9rZW5cIik7XHJcbmNvbnN0IGNvbmZpZyA9IHJlcXVpcmUoXCIuLi9jb25maWcvY29uZmlnXCIpO1xyXG5jb25zdCB7IFVzZXIgfSA9IHJlcXVpcmUoXCIuLi9tb2RlbHNcIik7XHJcbi8vIGNvbnN0IHVzZXJTZXJ2aWNlID0gcmVxdWlyZShcIi4uL3NlcnZpY2VzL3VzZXIuc2VydmljZVwiKTtcclxuXHJcbi8vIHRva2VuIGlzIHJldHJpZXZlZCBmcm9tIGF1dGhvcml6YXRpb24gaGVhZGVyIGFuZCBjaGVjayBpZiBpdHMgdmFsaWRcclxuY29uc3QgdmVyaWZ5VG9rZW4gPSAocmVxLCByZXMsIG5leHQpID0+IHtcclxuICBpZiAoXHJcbiAgICByZXEuaGVhZGVycyAmJlxyXG4gICAgcmVxLmhlYWRlcnMuYXV0aG9yaXphdGlvbiAmJlxyXG4gICAgcmVxLmhlYWRlcnMuYXV0aG9yaXphdGlvbi5zcGxpdChcIiBcIilbMF0gPT09IFwiSldUXCJcclxuICApIHtcclxuICAgIGp3dC52ZXJpZnkoXHJcbiAgICAgIHJlcS5oZWFkZXJzLmF1dGhvcml6YXRpb24uc3BsaXQoXCIgXCIpWzFdLFxyXG4gICAgICBjb25maWcuand0LnNlY3JldCxcclxuICAgICAgZnVuY3Rpb24gKGVyciwgZGVjb2RlKSB7XHJcbiAgICAgICAgaWYgKGVycikge1xyXG4gICAgICAgICAgcmVxLnVzZXIgPSBudWxsO1xyXG4gICAgICAgICAgcmVxLm1lc3NhZ2UgPSBcIkludmFsaWQgSldUIHRva2VuOiBcIiArIGVycjtcclxuICAgICAgICAgIG5leHQoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIFVzZXIuZmluZE9uZSh7XHJcbiAgICAgICAgICBfaWQ6IGRlY29kZS5zdWIsXHJcbiAgICAgICAgfSlcclxuICAgICAgICAgIC50aGVuKCh1c2VyKSA9PiB7XHJcbiAgICAgICAgICAgIHJlcS51c2VyID0gdXNlcjtcclxuICAgICAgICAgICAgcmVxLm1lc3NhZ2UgPSBcIlVzZXIgdmFsaWRhdGVkXCI7XHJcbiAgICAgICAgICAgIG5leHQoKTtcclxuICAgICAgICAgIH0pXHJcbiAgICAgICAgICAuY2F0Y2goKGVycikgPT4ge1xyXG4gICAgICAgICAgICByZXEudXNlciA9IG51bGw7XHJcbiAgICAgICAgICAgIHJlcS5tZXNzYWdlID0gXCJVc2VyIG5vdCBmb3VuZFwiO1xyXG4gICAgICAgICAgICBuZXh0KCk7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgKTtcclxuICB9IGVsc2Uge1xyXG4gICAgcmVxLnVzZXIgPSBudWxsO1xyXG4gICAgcmVxLm1lc3NhZ2UgPSBcIkF1dGhvcml6YXRpb24gSGVhZGVyIG5vdCBmb3VuZFwiO1xyXG4gICAgbmV4dCgpO1xyXG4gIH1cclxufTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0ge1xyXG4gIHZlcmlmeVRva2VuLFxyXG59O1xyXG4iXSwibWFwcGluZ3MiOiI2cUdBZVk7QUFBQUEsYUFBQSxTQUFBQSxDQUFBLFNBQUFDLGNBQUEsV0FBQUEsY0FBQSxFQUFBRCxhQUFBLEdBZlosS0FBTSxDQUFBRSxHQUFHLEVBQUFGLGFBQUEsR0FBQUcsQ0FBQSxNQUFHQyxPQUFPLENBQUMsY0FBYyxDQUFDLEVBQ25DLEtBQU0sQ0FBQUMsTUFB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